<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>المشغّل</title>
  <style>
    html,body{margin:0;height:100%;background:#000;color:#fff;font-family:system-ui, Arial;}
    .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:12px;box-sizing:border-box;}
    video{width:min(100%,1000px);height:auto;background:#000;border-radius:12px;}
    .bar{max-width:1000px;margin:8px auto;display:flex;justify-content:space-between;align-items:center;gap:10px;}
    .btn{background:#1976d2;color:#fff;padding:8px 12px;border:0;border-radius:10px;cursor:pointer;font-weight:700;text-decoration:none;}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>
<body>
  <div class="wrap"><video id="v" controls playsinline webkit-playsinline preload="metadata"></video></div>
  <div class="bar">
    <a id="openSrc" class="btn" target="_blank" rel="noopener">فتح المصدر</a>
    <div id="title">قناة مباشرة</div>
  </div>
  <script>
    const q = new URL(location.href).searchParams;
    const src = q.get('src');
    const title = q.get('title') || 'قناة مباشرة';
    document.getElementById('title').textContent = title;
    document.getElementById('openSrc').href = src || '#';

    const video = document.getElementById('v');
    if(!src){ document.body.innerHTML = '<h2 style="text-align:center">لا يوجد رابط</h2>'; }
    else if (src.endsWith('.m3u8') || src.includes('.ts')) {
      if (video.canPlayType('application/vnd.apple.mpegURL')) {
        video.src = src; video.play().catch(()=>{});
      } else if (window.Hls && Hls.isSupported()) {
        const hls = new Hls({ enableWorker:true });
        hls.loadSource(src);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, ()=>video.play().catch(()=>{}));
      } else {
        video.src = src; video.play().catch(()=>{});
      }
    } else {
      video.src = src; video.play().catch(()=>{});
    }
  </script>
</body>
</html>
