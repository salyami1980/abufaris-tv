<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>المشغل</title>
  <style>
    body { margin:0; background:#000; color:#fff; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; }
    video { width:100%; max-width:900px; background:#000; border-radius:10px; }
    .actions{margin-top:8px;display:flex;gap:10px;}
    a.btn{padding:10px 14px;border-radius:8px;text-decoration:none;font-weight:700}
    .btn-close{background:#ff5252;color:#fff;}
    .btn-open{background:#1976d2;color:#fff;}
  </style>
</head>
<body>
  <video id="v" controls autoplay playsinline webkit-playsinline></video>
  <div class="actions">
    <a id="srcBtn" class="btn btn-open" target="_blank">فتح المصدر</a>
    <a href="index.html" class="btn btn-close">إغلاق</a>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    const q=new URLSearchParams(location.search);
    const raw=q.get("src")||"";
    const title=q.get("title")||"قناة مباشرة";
    document.title=title;
    document.getElementById("srcBtn").href=raw;

    const video=document.getElementById("v");

    // لو كان الرابط TS فقط → نحوله لقائمة M3U8 مؤقتة
    function makeM3U8(tsUrl){
      return [
        "#EXTM3U",
        "#EXT-X-VERSION:3",
        "#EXT-X-TARGETDURATION:36000",
        "#EXT-X-MEDIA-SEQUENCE:0",
        "#EXTINF:36000.0,",
        tsUrl,
        "#EXT-X-ENDLIST"
      ].join("\n");
    }

    let finalUrl=raw;
    if (/\.ts(\?|$)/i.test(raw)){
      const blob=new Blob([makeM3U8(raw)],{type:"application/vnd.apple.mpegURL"});
      finalUrl=URL.createObjectURL(blob);
    }

    if(video.canPlayType("application/vnd.apple.mpegURL")){
      video.src=finalUrl;
    }else if(Hls.isSupported()){
      const hls=new Hls();
      hls.loadSource(finalUrl);
      hls.attachMedia(video);
    }else{
      video.src=raw;
    }
  </script>
</body>
</html>
