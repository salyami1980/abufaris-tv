<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no" />
  <title>القنوات الرياضية – TV</title>
  <style>
    :root{ --safe-pad:32px; --radius:22px; --focus-ring:5px; --accent:#ffc107; --v-gap:16px; --max-w:600px; }
    @media (min-width:2560px){ :root{ --safe-pad:44px; --max-w:1100px; } }
    html,body{ margin:0;height:100%; background:#212121;color:#fafafa; font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Kufi Arabic","Noto Sans Arabic",Arial,sans-serif; -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility; overscroll-behavior:none; }
    .page{ min-height:100%; box-sizing:border-box; padding:var(--safe-pad); display:flex; flex-direction:column; align-items:center; }
    header{ text-align:center;margin-bottom:14px; }
    header h1{ margin:0 0 4px; font-size:clamp(28px,4.5vw,62px); font-weight:800; }
    header .sub{ opacity:.85; font-size:clamp(16px,2.2vw,24px); }
    .stack{ width:min(100%,var(--max-w)); margin-inline:auto; display:flex; flex-direction:column; gap:var(--v-gap); }
    .tile{ position:relative; display:block; overflow:hidden; border-radius:var(--radius); background:transparent; outline:none; }
    .thumb{ display:block; width:100%; height:auto; object-fit:contain; background:transparent; border-radius:inherit; }
    .tile.link:focus{ outline:none; }
    .tile.link:focus-visible::after,.tile.link[tabindex="0"]:focus::after{ content:""; position:absolute; inset:0; border:var(--focus-ring) solid var(--accent); border-radius:inherit; pointer-events:none; }
    .banner{ pointer-events:none; }
    footer{ text-align:center; margin-top:20px; opacity:.9; font-weight:700; font-size:clamp(16px,2vw,22px); }
    main{ width:100%; scroll-behavior:auto; overscroll-behavior:contain; }
    a,.tile{ -webkit-tap-highlight-color:rgba(0,0,0,0); }
    .player-overlay{ position:fixed; inset:0; background:rgba(0,0,0,.88); display:none; align-items:center; justify-content:center; z-index:9999; }
    .player-card{ width:min(100%,900px); background:#000; border-radius:16px; padding:12px; }
    .player-card video{ width:100%; height:auto; border-radius:12px; background:#000; }
    .player-actions{ display:flex; gap:8px; justify-content:space-between; margin-top:8px; align-items:center; color:#fff; }
    .btn{ padding:10px 14px; border-radius:10px; border:0; cursor:pointer; font-weight:700 }
    .btn-close{ background:#ff5252;color:#fff; }
    .btn-open-ext{ background:#1976d2;color:#fff; }
    .title{ font-weight:700; }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <h1>القنوات الرياضية – بث مباشر</h1>
      <div class="sub">تنقّل بالريموت (↑ ↓) واضغط OK للدخول</div>
    </header>

    <main>
      <div class="stack" id="stack" role="list">
        <div class="tile banner" aria-hidden="true" tabindex="-1" role="presentation">
          <img class="thumb" loading="lazy" src="https://www4.0zz0.com/2024/02/01/09/100522793.png" alt="" />
        </div>

        <!-- غلاف القنوات (اختصرتها هنا، ابقِ كل عناصر <a> كما لديك) -->
        <a class="tile link" href="go:1"  tabindex="0" aria-label="قناة 1"><img class="thumb" loading="lazy" src="https://i.suar.me/VWaMw/l" alt="قناة 1" /></a>
        <!-- … بقية القنوات … -->
      </div>
    </main>

    <footer>Abu Faris TV Sport</footer>
  </div>

  <!-- HLS -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

  <!-- طبقة المشغل -->
  <div class="player-overlay" id="overlay" role="dialog" aria-modal="true" aria-label="مشغل الفيديو">
    <div class="player-card">
      <video id="player" controls playsinline webkit-playsinline preload="metadata"></video>
      <div class="player-actions">
        <span class="title" id="chanTitle"></span>
        <div>
          <a id="openExternal" class="btn btn-open-ext" target="_blank" rel="noopener">فتح في نافذة</a>
          <button class="btn btn-close" id="closeBtn">إغلاق</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== إعدادات وروابط =====
    const PROXY_ORIGIN = 'https://abufaris.salyami1980.workers.dev';
    const prox = (rawUrl) => `${PROXY_ORIGIN}/?url=${encodeURIComponent(rawUrl)}`;

    const RAW = {
      1:"http://storatv.com/live/0543539887/2280625079/483688.ts",
      2:"http://storatv.com/live/0543539887/2280625079/483657.ts",
      3:"http://storatv.com/live/0543539887/2280625079/483660.ts",
      4:"http://storatv.com/live/0543539887/2280625079/483663.ts",
      5:"http://storatv.com/live/0543539887/2280625079/483667.ts",
      6:"http://storatv.com/live/0543539887/2280625079/689531.ts",
      7:"http://storatv.com/live/0543539887/2280625079/689534.ts",
      8:"http://storatv.com/live/0543539887/2280625079/689535.ts",
      9:"http://storatv.com/live/0543539887/2280625079/689536.ts",
      10:"http://storatv.com/live/0543539887/2280625079/689539.ts",
      11:"http://storatv.com/live/0543539887/2280625079/483669.ts",
      12:"http://storatv.com/live/0543539887/2280625079/483672.ts",
      13:"http://storatv.com/live/0543539887/2280625079/483675.ts",
      14:"http://storatv.com/live/0543539887/2280625079/483678.ts",
      15:"http://storatv.com/live/0543539887/2280625079/689557.ts",
      16:"http://storatv.com/live/0543539887/2280625079/689559.ts",
      17:"http://storatv.com/live/0543539887/2280625079/689546.ts",
      18:"http://storatv.com/live/0543539887/2280625079/69195.ts",
      19:"http://storatv.com/live/0543539887/2280625079/69196.ts",
      20:"http://storatv.com/live/0543539887/2280625079/178390.ts",
      21:"http://storatv.com/live/0543539887/2280625079/222044.ts",
      22:"http://storatv.com/live/0543539887/2280625079/222045.ts",
      23:"http://storatv.com/live/0543539887/2280625079/222047.ts",
      24:"http://storatv.com/live/0543539887/2280625079/362201.ts",
      25:"http://storatv.com/live/0543539887/2280625079/362204.ts",
      26:"http://storatv.com/live/0543539887/2280625079/763544.ts",
      27:"http://storatv.com/live/0543539887/2280625079/763547.ts",
      28:"http://storatv.com/live/0543539887/2280625079/763550.ts"
    };

    const STREAMS = Object.fromEntries(Object.entries(RAW).map(([k,v]) => [k, prox(v)]));

    const overlay = document.getElementById('overlay');
    const videoEl = document.getElementById('player');
    const closeBtn = document.getElementById('closeBtn');
    const titleEl = document.getElementById('chanTitle');
    const openExt = document.getElementById('openExternal');
    let hlsInstance=null, blobUrl=null;

    // تركيز أول عنصر
    (function(){ const first=document.querySelector('.tile.link'); if(first){ first.focus({preventScroll:true}); first.scrollIntoView({block:'center'}); }})();

    // فتح القناة عند النقر
    document.addEventListener('click',(e)=>{
      const a=e.target.closest('a.tile.link[href^="go:"]'); if(!a) return;
      e.preventDefault();
      const id=a.getAttribute('href').split(':')[1];
      const url=STREAMS[id]; if(!url){ alert('لا يوجد رابط'); return; }
      titleEl.textContent=a.getAttribute('aria-label')||('قناة '+id);
      playUrl(url);
    });

    function playUrl(url){
      overlay.style.display='flex';
      cleanupPlayer();

      const isM3U8=/\.m3u8(\?|$)/i.test(url);
      const isTS=/\.ts(\?|$)/i.test(url);

      // رابط النافذة المطلقة على GitHub Pages
      const base = location.origin + location.pathname.replace(/[^/]+$/, '');
      openExt.href = `${base}player.html?src=${encodeURIComponent(url)}&title=${encodeURIComponent(titleEl.textContent||'قناة')}`;
      openExt.target = '_blank';
      openExt.rel = 'noopener';

      if(isTS){
        const m3u8Text=makeSingleM3U8(url);
        const blob=new Blob([m3u8Text],{type:'application/vnd.apple.mpegURL'});
        blobUrl=URL.createObjectURL(blob);
        startHls(blobUrl);
        return;
      }
      if(isM3U8){ startHls(url); return; }

      videoEl.src=url; videoEl.play().catch(()=>{});
    }

    function startHls(src){
      if(videoEl.canPlayType('application/vnd.apple.mpegURL')){
        videoEl.src=src; videoEl.play().catch(()=>{});
      }else if(window.Hls && Hls.isSupported()){
        hlsInstance=new Hls({enableWorker:true});
        hlsInstance.loadSource(src);
        hlsInstance.attachMedia(videoEl);
        hlsInstance.on(Hls.Events.MANIFEST_PARSED,()=>videoEl.play().catch(()=>{}));
      }else{
        videoEl.src=src; videoEl.play().catch(()=>{});
      }
    }

    function makeSingleM3U8(tsUrl){
      const TARGET=36000;
      return [
        '#EXTM3U',
        '#EXT-X-VERSION:3',
        `#EXT-X-TARGETDURATION:${TARGET}`,
        '#EXT-X-MEDIA-SEQUENCE:0',
        `#EXTINF:${TARGET}.0,`,
        tsUrl,
        '#EXT-X-ENDLIST'
      ].join('\n');
    }

    function cleanupPlayer(){
      try{
        if(hlsInstance){ hlsInstance.destroy(); hlsInstance=null; }
        if(blobUrl){ URL.revokeObjectURL(blobUrl); blobUrl=null; }
        videoEl.pause(); videoEl.removeAttribute('src'); videoEl.load();
      }catch(e){}
    }
    function closePlayer(){ overlay.style.display='none'; cleanupPlayer(); }
    closeBtn.addEventListener('click', closePlayer);
    overlay.addEventListener('click', (e)=>{ if(e.target===overlay) closePlayer(); });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closePlayer(); });
  </script>
</body>
</html>
